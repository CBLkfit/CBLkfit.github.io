<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-logistic regression" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/31/logistic%20regression/" class="article-date">
  <time class="dt-published" datetime="2020-12-31T04:28:11.968Z" itemprop="datePublished">2020-12-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>![image-20201231122853343](/Users/cbl/MyBlog/source/_posts/logistic regression/image-20201231122853343.png)</p>
<p>![image-20201231135901370](/Users/cbl/MyBlog/source/_posts/logistic regression/image-20201231135901370.png)</p>
<p>![image-20201231135923774](/Users/cbl/MyBlog/source/_posts/logistic regression/image-20201231135923774.png)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/31/logistic%20regression/" data-id="ckjchmphj0004e0fy69ru8uih" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-用docker部署python环境" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/30/%E7%94%A8docker%E9%83%A8%E7%BD%B2python%E7%8E%AF%E5%A2%83/" class="article-date">
  <time class="dt-published" datetime="2020-12-30T04:12:01.000Z" itemprop="datePublished">2020-12-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/30/%E7%94%A8docker%E9%83%A8%E7%BD%B2python%E7%8E%AF%E5%A2%83/">用docker部署python环境</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>查找<a target="_blank" rel="noopener" href="https://hub.docker.com/_/python?tab=tags&page=1&ordering=last_updated">dockerhub</a>上的python镜像，拉取镜像</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker pull python:<span class="number">3.8</span><span class="number">.7</span>-slim-buster</span><br><span class="line">➜  ~ docker images</span><br></pre></td></tr></table></figure>
<p><strong>-it：</strong>进入容器命令行模式</p>
<p><strong>–name：</strong>自定义容器名称，不用的话会自动分配一个名称</p>
<p><strong>-v ~/mednli:/root/mednli：</strong>将主机目录~/mednli挂载到容器的root/mednli</p>
<p><strong>python:3.8.7-slim-buster：</strong>要运行的镜像名+TAG</p>
<p><strong>bash：</strong>进入容器命令行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker run -it --name pytest -v ~<span class="regexp">/mednli:/</span>root/mednli python:<span class="number">3.8</span><span class="number">.7</span>-slim-buster bash</span><br></pre></td></tr></table></figure>
<p>安装需要的python包</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@e408c3c08685:~# pip install -r ~/mednli/requirements.txt</span><br></pre></td></tr></table></figure>
<p><code>exit</code>推出docker容器</p>
<p>查看容器信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                      COMMAND    CREATED       STATUS                      PORTS     NAMES</span><br><span class="line">e408c3c08685   python:<span class="number">3.8</span><span class="number">.7</span>-slim-buster   <span class="string">&quot;bash&quot;</span>     <span class="number">2</span> hours ago   Exited (<span class="number">0</span>) <span class="number">42</span> seconds ago             pytest</span><br><span class="line">3609dfb44e20   hello-world                <span class="string">&quot;/hello&quot;</span>   <span class="number">8</span> days ago    Exited (<span class="number">0</span>) <span class="number">8</span> days ago                 crazy_mendel</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>容器打包📦成镜像</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker commit -a <span class="string">&quot;cbl&quot;</span> -m <span class="string">&quot;my python env&quot;</span> e408c3c08685 python_env:v1</span><br></pre></td></tr></table></figure>
<p><strong>-a：</strong>提交的作者名称</p>
<p><strong>-m：</strong>提交时的文字说明</p>
<p><strong>e408c3c08685：</strong>容器ID</p>
<p><strong>python_env:v1：</strong>镜像名字:TAG</p>
<h4 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h4><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/bjjoy2009/article/details/105854908/">https://blog.csdn.net/bjjoy2009/article/details/105854908/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-command-manual.html">Docker命令行大全</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/30/%E7%94%A8docker%E9%83%A8%E7%BD%B2python%E7%8E%AF%E5%A2%83/" data-id="ckjchmphl0006e0fy55dk61o9" data-title="用docker部署python环境" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-学习fairseq之Roberta" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/28/%E5%AD%A6%E4%B9%A0fairseq%E4%B9%8BRoberta/" class="article-date">
  <time class="dt-published" datetime="2020-12-28T09:14:27.000Z" itemprop="datePublished">2020-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/28/%E5%AD%A6%E4%B9%A0fairseq%E4%B9%8BRoberta/">学习fairseq之Roberta</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>git clone https://github.com/pytorch/fairseq.git</code></p>
<p><code>cd fairseq</code></p>
<p><code>pip install --editable ./</code></p>
<p>For MacOS:</p>
<p><code>CFLAGS=&quot;-stdlib=libc++&quot; pip install --editable ./</code></p>
<p>接下来可以参考<a target="_blank" rel="noopener" href="https://github.com/pytorch/fairseq/blob/master/examples/roberta/README.pretraining.md">https://github.com/pytorch/fairseq/blob/master/examples/roberta/README.pretraining.md</a> </p>
<p>下载数据集<em>WikiText-103</em>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="comment">//s3.amazonaws.com/research.metamind.io/wikitext/wikitext-103-raw-v1.zip</span></span><br><span class="line">unzip wikitext-<span class="number">103</span>-raw-v1.zip</span><br></pre></td></tr></table></figure>
<p>将数据集按照GPT-2 BPE进行编码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p gpt2_bpe</span><br><span class="line">wget -O gpt2_bpe/encoder.json https:<span class="comment">//dl.fbaipublicfiles.com/fairseq/gpt2_bpe/encoder.json</span></span><br><span class="line">wget -O gpt2_bpe/vocab.bpe https:<span class="comment">//dl.fbaipublicfiles.com/fairseq/gpt2_bpe/vocab.bpe</span></span><br><span class="line"><span class="keyword">for</span> SPLIT <span class="keyword">in</span> train valid test; <span class="keyword">do</span> \</span><br><span class="line">    python -m examples.roberta.multiprocessing_bpe_encoder \</span><br><span class="line">        --encoder-json gpt2_bpe/encoder.json \</span><br><span class="line">        --vocab-bpe gpt2_bpe/vocab.bpe \</span><br><span class="line">        --inputs wikitext-<span class="number">103</span>-raw/wiki.$&#123;SPLIT&#125;.raw \</span><br><span class="line">        --outputs wikitext-<span class="number">103</span>-raw/wiki.$&#123;SPLIT&#125;.bpe \</span><br><span class="line">        --keep-empty \</span><br><span class="line">        --workers <span class="number">60</span>; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget -O gpt2_bpe/dict.txt https:<span class="comment">//dl.fbaipublicfiles.com/fairseq/gpt2_bpe/dict.txt</span></span><br><span class="line">fairseq-preprocess \</span><br><span class="line">    --only-source \</span><br><span class="line">    --srcdict gpt2_bpe/dict.txt \</span><br><span class="line">    --trainpref wikitext-<span class="number">103</span>-raw/wiki.train.bpe \</span><br><span class="line">    --validpref wikitext-<span class="number">103</span>-raw/wiki.valid.bpe \</span><br><span class="line">    --testpref wikitext-<span class="number">103</span>-raw/wiki.test.bpe \</span><br><span class="line">    --destdir data-bin/wikitext-<span class="number">103</span> \</span><br><span class="line">    --workers <span class="number">60</span></span><br></pre></td></tr></table></figure>
<p>得到<em>data-bin/wikitext-103</em> 文件夹，文件夹下是预处理好的数据集。</p>
<p>接下来可以开始训练啦，需要用到GPU资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TOTAL_UPDATES=125000    # Total number of training steps</span><br><span class="line">WARMUP_UPDATES=10000    # Warmup the learning rate over this many updates</span><br><span class="line">PEAK_LR=0.0005          # Peak learning rate, adjust as needed</span><br><span class="line">TOKENS_PER_SAMPLE=512   # Max sequence length</span><br><span class="line">MAX_POSITIONS=512       # Num. positional embeddings (usually same as above)</span><br><span class="line">MAX_SENTENCES=16        # Number of sequences per batch (batch size)</span><br><span class="line">UPDATE_FREQ=16          # Increase the batch size 16x</span><br><span class="line"></span><br><span class="line">DATA_DIR=data-bin/wikitext-<span class="number">103</span></span><br><span class="line"></span><br><span class="line">fairseq-train --fp16 $DATA_DIR \</span><br><span class="line">    --task masked_lm --criterion masked_lm \</span><br><span class="line">    --arch roberta_base --sample-<span class="keyword">break</span>-mode complete --tokens-per-sample $TOKENS_PER_SAMPLE \</span><br><span class="line">    --optimizer adam --adam-betas <span class="string">&#x27;(0.9,0.98)&#x27;</span> --adam-eps <span class="number">1e-6</span> --clip-norm <span class="number">0.0</span> \</span><br><span class="line">    --lr-scheduler polynomial_decay --lr $PEAK_LR --warmup-updates $WARMUP_UPDATES --total-num-update $TOTAL_UPDATES \</span><br><span class="line">    --dropout <span class="number">0.1</span> --attention-dropout <span class="number">0.1</span> --weight-decay <span class="number">0.01</span> \</span><br><span class="line">    --batch-size $MAX_SENTENCES --update-freq $UPDATE_FREQ \</span><br><span class="line">    --max-update $TOTAL_UPDATES --log-format simple --log-interval <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>如果出现如下错误信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Error</span>: mkl-service + Intel(R) MKL: MKL_THREADING_LAYER=INTEL is incompatible <span class="keyword">with</span> libgomp.so<span class="number">.1</span> library.</span><br><span class="line">        Try to <span class="keyword">import</span> numpy first or set the threading layer accordingly. <span class="built_in">Set</span> MKL_SERVICE_FORCE_INTEL to force it.</span><br></pre></td></tr></table></figure>
<p>在*~/.bashrc* 中添加<code>export MKL_THREADING_LAYER=GNU</code>就可以解决：</p>
<p>Warning</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/User/miniconda3/lib/python3<span class="number">.8</span>/site-packages/torch/nn/parallel/distributed.py:<span class="number">397</span>: UserWarning: The <span class="string">`check_reduction`</span> argument <span class="keyword">in</span> <span class="string">`DistributedDataParallel`</span> <span class="built_in">module</span> is deprecated. Please avoid using it.</span><br></pre></td></tr></table></figure>


<p>8卡服务器运行：</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 0): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 1): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 2): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 6): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 5): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 3): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 4): tcp://localhost:12737</p>
<p>2020-12-28 15:40:38 | INFO | fairseq.distributed_utils | distributed init (rank 7): tcp://localhost:12737</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 5</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 6</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 0</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 7</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 3</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 2</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 4</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.distributed_utils | initialized host song1-SYS-4029GP-TRT as rank 1</p>
<p>2020-12-28 15:40:45 | INFO | fairseq_cli.train | {‘_name’: None, ‘common’: {‘_name’: None, ‘no_progress_bar’: False, ‘log_interval’: 1, ‘log_format’: ‘simple’, ‘tensorboard_logdir’: None, ‘wandb_project’: None, ‘azureml_logging’: False, ‘seed’: 1, ‘cpu’: False, ‘tpu’: False, ‘bf16’: False, ‘memory_efficient_bf16’: False, ‘fp16’: True, ‘memory_efficient_fp16’: False, ‘fp16_no_flatten_grads’: False, ‘fp16_init_scale’: 128, ‘fp16_scale_window’: None, ‘fp16_scale_tolerance’: 0.0, ‘min_loss_scale’: 0.0001, ‘threshold_loss_scale’: None, ‘user_dir’: None, ‘empty_cache_freq’: 0, ‘all_gather_list_size’: 16384, ‘model_parallel_size’: 1, ‘quantization_config_path’: None, ‘profile’: False, ‘reset_logging’: True}, ‘common_eval’: {‘_name’: None, ‘path’: None, ‘post_process’: None, ‘quiet’: False, ‘model_overrides’: ‘{}’, ‘results_path’: None}, ‘distributed_training’: {‘_name’: None, ‘distributed_world_size’: 8, ‘distributed_rank’: 0, ‘distributed_backend’: ‘nccl’, ‘distributed_init_method’: ‘tcp://localhost:12737’, ‘distributed_port’: -1, ‘device_id’: 0, ‘distributed_no_spawn’: False, ‘ddp_backend’: ‘c10d’, ‘bucket_cap_mb’: 25, ‘fix_batches_to_gpus’: False, ‘find_unused_parameters’: False, ‘fast_stat_sync’: False, ‘heartbeat_timeout’: -1, ‘broadcast_buffers’: False, ‘distributed_wrapper’: ‘DDP’, ‘slowmo_momentum’: None, ‘slowmo_algorithm’: ‘LocalSGD’, ‘localsgd_frequency’: 3, ‘nprocs_per_node’: 8, ‘pipeline_model_parallel’: False, ‘pipeline_balance’: None, ‘pipeline_devices’: None, ‘pipeline_chunks’: 0, ‘pipeline_encoder_balance’: None, ‘pipeline_encoder_devices’: None, ‘pipeline_decoder_balance’: None, ‘pipeline_decoder_devices’: None, ‘pipeline_checkpoint’: ‘never’, ‘zero_sharding’: ‘none’, ‘tpu’: False, ‘distributed_num_procs’: 8}, ‘dataset’: {‘_name’: None, ‘num_workers’: 1, ‘skip_invalid_size_inputs_valid_test’: False, ‘max_tokens’: None, ‘batch_size’: 16, ‘required_batch_size_multiple’: 8, ‘required_seq_len_multiple’: 1, ‘dataset_impl’: None, ‘data_buffer_size’: 10, ‘train_subset’: ‘train’, ‘valid_subset’: ‘valid’, ‘validate_interval’: 1, ‘validate_interval_updates’: 0, ‘validate_after_updates’: 0, ‘fixed_validation_seed’: None, ‘disable_validation’: False, ‘max_tokens_valid’: None, ‘batch_size_valid’: 16, ‘curriculum’: 0, ‘gen_subset’: ‘test’, ‘num_shards’: 1, ‘shard_id’: 0}, ‘optimization’: {‘_name’: None, ‘max_epoch’: 0, ‘max_update’: 125000, ‘stop_time_hours’: 0.0, ‘clip_norm’: 0.0, ‘sentence_avg’: False, ‘update_freq’: [16], ‘lr’: [0.0005], ‘stop_min_lr’: -1.0, ‘use_bmuf’: False}, ‘checkpoint’: {‘_name’: None, ‘save_dir’: ‘checkpoints’, ‘restore_file’: ‘checkpoint_last.pt’, ‘finetune_from_model’: None, ‘reset_dataloader’: False, ‘reset_lr_scheduler’: False, ‘reset_meters’: False, ‘reset_optimizer’: False, ‘optimizer_overrides’: ‘{}’, ‘save_interval’: 1, ‘save_interval_updates’: 0, ‘keep_interval_updates’: -1, ‘keep_last_epochs’: -1, ‘keep_best_checkpoints’: -1, ‘no_save’: False, ‘no_epoch_checkpoints’: False, ‘no_last_checkpoints’: False, ‘no_save_optimizer_state’: False, ‘best_checkpoint_metric’: ‘loss’, ‘maximize_best_checkpoint_metric’: False, ‘patience’: -1, ‘checkpoint_suffix’: ‘’, ‘checkpoint_shard_count’: 1, ‘load_checkpoint_on_all_dp_ranks’: False, ‘model_parallel_size’: 1, ‘distributed_rank’: 0}, ‘bmuf’: {‘_name’: None, ‘block_lr’: 1.0, ‘block_momentum’: 0.875, ‘global_sync_iter’: 50, ‘warmup_iterations’: 500, ‘use_nbm’: False, ‘average_sync’: False, ‘distributed_world_size’: 8}, ‘generation’: {‘_name’: None, ‘beam’: 5, ‘nbest’: 1, ‘max_len_a’: 0.0, ‘max_len_b’: 200, ‘min_len’: 1, ‘match_source_len’: False, ‘unnormalized’: False, ‘no_early_stop’: False, ‘no_beamable_mm’: False, ‘lenpen’: 1.0, ‘unkpen’: 0.0, ‘replace_unk’: None, ‘sacrebleu’: False, ‘score_reference’: False, ‘prefix_size’: 0, ‘no_repeat_ngram_size’: 0, ‘sampling’: False, ‘sampling_topk’: -1, ‘sampling_topp’: -1.0, ‘constraints’: None, ‘temperature’: 1.0, ‘diverse_beam_groups’: -1, ‘diverse_beam_strength’: 0.5, ‘diversity_rate’: -1.0, ‘print_alignment’: None, ‘print_step’: False, ‘lm_path’: None, ‘lm_weight’: 0.0, ‘iter_decode_eos_penalty’: 0.0, ‘iter_decode_max_iter’: 10, ‘iter_decode_force_max_iter’: False, ‘iter_decode_with_beam’: 1, ‘iter_decode_with_external_reranker’: False, ‘retain_iter_history’: False, ‘retain_dropout’: False, ‘retain_dropout_modules’: None, ‘decoding_format’: None, ‘no_seed_provided’: False}, ‘eval_lm’: {‘_name’: None, ‘output_word_probs’: False, ‘output_word_stats’: False, ‘context_window’: 0, ‘softmax_batch’: 9223372036854775807}, ‘interactive’: {‘_name’: None, ‘buffer_size’: 0, ‘input’: ‘-‘}, ‘model’: Namespace(_name=’roberta_base’, activation_dropout=0.0, activation_fn=’gelu’, adam_betas=’(0.9,0.98)’, adam_eps=1e-06, all_gather_list_size=16384, arch=’roberta_base’, attention_dropout=0.1, azureml_logging=False, batch_size=16, batch_size_valid=16, best_checkpoint_metric=’loss’, bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix=’’, clip_norm=0.0, cpu=False, criterion=’masked_lm’, curriculum=0, data=’data-bin/wikitext-103’, data_buffer_size=10, dataset_impl=None, ddp_backend=’c10d’, device_id=0, disable_validation=False, distributed_backend=’nccl’, distributed_init_method=None, distributed_no_spawn=False, distributed_port=-1, distributed_rank=0, distributed_world_size=8, distributed_wrapper=’DDP’, dropout=0.1, empty_cache_freq=0, encoder_attention_heads=12, encoder_embed_dim=768, encoder_ffn_embed_dim=3072, encoder_layerdrop=0, encoder_layers=12, encoder_layers_to_keep=None, end_learning_rate=0.0, eos=2, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=True, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, freq_weighted_replacement=False, gen_subset=’test’, heartbeat_timeout=-1, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_last_epochs=-1, leave_unmasked_prob=0.1, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_format=’simple’, log_interval=1, lr=[0.0005], lr_scheduler=’polynomial_decay’, mask_multiple_length=1, mask_prob=0.15, mask_stdev=0.0, mask_whole_words=False, max_epoch=0, max_tokens=None, max_tokens_valid=None, max_update=125000, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_loss_scale=0.0001, model_parallel_size=1, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, nprocs_per_node=8, num_shards=1, num_workers=1, optimizer=’adam’, optimizer_overrides=’{}’, pad=1, patience=-1, pipeline_balance=None, pipeline_checkpoint=’never’, pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, pooler_activation_fn=’tanh’, pooler_dropout=0.0, power=1.0, profile=False, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, quantization_config_path=None, random_token_prob=0.1, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=True, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file=’checkpoint_last.pt’, sample_break_mode=’complete’, save_dir=’checkpoints’, save_interval=1, save_interval_updates=0, scoring=’bleu’, seed=1, sentence_avg=False, shard_id=0, shorten_data_split_list=’’, shorten_method=’none’, skip_invalid_size_inputs_valid_test=False, slowmo_algorithm=’LocalSGD’, slowmo_momentum=None, spectral_norm_classification_head=False, stop_min_lr=-1.0, stop_time_hours=0, task=’masked_lm’, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tokens_per_sample=512, total_num_update=’125000’, tpu=False, train_subset=’train’, unk=3, untie_weights_roberta=False, update_freq=[16], use_bmuf=False, use_old_adam=False, user_dir=None, valid_subset=’valid’, validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=10000, weight_decay=0.01, zero_sharding=’none’), ‘task’: Namespace(_name=’masked_lm’, activation_dropout=0.0, activation_fn=’gelu’, adam_betas=’(0.9,0.98)’, adam_eps=1e-06, all_gather_list_size=16384, arch=’roberta_base’, attention_dropout=0.1, azureml_logging=False, batch_size=16, batch_size_valid=16, best_checkpoint_metric=’loss’, bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix=’’, clip_norm=0.0, cpu=False, criterion=’masked_lm’, curriculum=0, data=’data-bin/wikitext-103’, data_buffer_size=10, dataset_impl=None, ddp_backend=’c10d’, device_id=0, disable_validation=False, distributed_backend=’nccl’, distributed_init_method=None, distributed_no_spawn=False, distributed_port=-1, distributed_rank=0, distributed_world_size=8, distributed_wrapper=’DDP’, dropout=0.1, empty_cache_freq=0, encoder_attention_heads=12, encoder_embed_dim=768, encoder_ffn_embed_dim=3072, encoder_layerdrop=0, encoder_layers=12, encoder_layers_to_keep=None, end_learning_rate=0.0, eos=2, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=True, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, freq_weighted_replacement=False, gen_subset=’test’, heartbeat_timeout=-1, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_last_epochs=-1, leave_unmasked_prob=0.1, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_format=’simple’, log_interval=1, lr=[0.0005], lr_scheduler=’polynomial_decay’, mask_multiple_length=1, mask_prob=0.15, mask_stdev=0.0, mask_whole_words=False, max_epoch=0, max_tokens=None, max_tokens_valid=None, max_update=125000, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_loss_scale=0.0001, model_parallel_size=1, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, nprocs_per_node=8, num_shards=1, num_workers=1, optimizer=’adam’, optimizer_overrides=’{}’, pad=1, patience=-1, pipeline_balance=None, pipeline_checkpoint=’never’, pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, pooler_activation_fn=’tanh’, pooler_dropout=0.0, power=1.0, profile=False, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, quantization_config_path=None, random_token_prob=0.1, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=True, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file=’checkpoint_last.pt’, sample_break_mode=’complete’, save_dir=’checkpoints’, save_interval=1, save_interval_updates=0, scoring=’bleu’, seed=1, sentence_avg=False, shard_id=0, shorten_data_split_list=’’, shorten_method=’none’, skip_invalid_size_inputs_valid_test=False, slowmo_algorithm=’LocalSGD’, slowmo_momentum=None, spectral_norm_classification_head=False, stop_min_lr=-1.0, stop_time_hours=0, task=’masked_lm’, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tokens_per_sample=512, total_num_update=’125000’, tpu=False, train_subset=’train’, unk=3, untie_weights_roberta=False, update_freq=[16], use_bmuf=False, use_old_adam=False, user_dir=None, valid_subset=’valid’, validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=10000, weight_decay=0.01, zero_sharding=’none’), ‘criterion’: Namespace(_name=’masked_lm’, activation_dropout=0.0, activation_fn=’gelu’, adam_betas=’(0.9,0.98)’, adam_eps=1e-06, all_gather_list_size=16384, arch=’roberta_base’, attention_dropout=0.1, azureml_logging=False, batch_size=16, batch_size_valid=16, best_checkpoint_metric=’loss’, bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix=’’, clip_norm=0.0, cpu=False, criterion=’masked_lm’, curriculum=0, data=’data-bin/wikitext-103’, data_buffer_size=10, dataset_impl=None, ddp_backend=’c10d’, device_id=0, disable_validation=False, distributed_backend=’nccl’, distributed_init_method=None, distributed_no_spawn=False, distributed_port=-1, distributed_rank=0, distributed_world_size=8, distributed_wrapper=’DDP’, dropout=0.1, empty_cache_freq=0, encoder_attention_heads=12, encoder_embed_dim=768, encoder_ffn_embed_dim=3072, encoder_layerdrop=0, encoder_layers=12, encoder_layers_to_keep=None, end_learning_rate=0.0, eos=2, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=True, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, freq_weighted_replacement=False, gen_subset=’test’, heartbeat_timeout=-1, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_last_epochs=-1, leave_unmasked_prob=0.1, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_format=’simple’, log_interval=1, lr=[0.0005], lr_scheduler=’polynomial_decay’, mask_multiple_length=1, mask_prob=0.15, mask_stdev=0.0, mask_whole_words=False, max_epoch=0, max_tokens=None, max_tokens_valid=None, max_update=125000, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_loss_scale=0.0001, model_parallel_size=1, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, nprocs_per_node=8, num_shards=1, num_workers=1, optimizer=’adam’, optimizer_overrides=’{}’, pad=1, patience=-1, pipeline_balance=None, pipeline_checkpoint=’never’, pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, pooler_activation_fn=’tanh’, pooler_dropout=0.0, power=1.0, profile=False, quant_noise_pq=0, quant_noise_pq_block_size=8, quant_noise_scalar=0, quantization_config_path=None, random_token_prob=0.1, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=True, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file=’checkpoint_last.pt’, sample_break_mode=’complete’, save_dir=’checkpoints’, save_interval=1, save_interval_updates=0, scoring=’bleu’, seed=1, sentence_avg=False, shard_id=0, shorten_data_split_list=’’, shorten_method=’none’, skip_invalid_size_inputs_valid_test=False, slowmo_algorithm=’LocalSGD’, slowmo_momentum=None, spectral_norm_classification_head=False, stop_min_lr=-1.0, stop_time_hours=0, task=’masked_lm’, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tokens_per_sample=512, total_num_update=’125000’, tpu=False, train_subset=’train’, unk=3, untie_weights_roberta=False, update_freq=[16], use_bmuf=False, use_old_adam=False, user_dir=None, valid_subset=’valid’, validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=10000, weight_decay=0.01, zero_sharding=’none’), ‘optimizer’: {‘_name’: ‘adam’, ‘adam_betas’: ‘(0.9,0.98)’, ‘adam_eps’: 1e-06, ‘weight_decay’: 0.01, ‘use_old_adam’: False, ‘tpu’: False, ‘lr’: [0.0005]}, ‘lr_scheduler’: {‘_name’: ‘polynomial_decay’, ‘warmup_updates’: 10000, ‘force_anneal’: None, ‘end_learning_rate’: 0.0, ‘power’: 1.0, ‘total_num_update’: 125000.0, ‘lr’: [0.0005]}, ‘scoring’: {‘_name’: ‘bleu’, ‘pad’: 1, ‘eos’: 2, ‘unk’: 3}, ‘bpe’: None, ‘tokenizer’: None}</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.tasks.masked_lm | dictionary: 50264 types</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.data.data_utils | loaded 3760 examples from: data-bin/wikitext-103/valid</p>
<p>2020-12-28 15:40:45 | INFO | fairseq.tasks.masked_lm | loaded 580 blocks from: data-bin/wikitext-103/valid</p>
<p>2020-12-28 15:40:51 | INFO | fairseq_cli.train | RobertaModel(</p>
<p> (encoder): RobertaEncoder(</p>
<p>  (sentence_encoder): TransformerSentenceEncoder(</p>
<p>   (dropout_module): FairseqDropout()</p>
<p>   (embed_tokens): Embedding(50265, 768, padding_idx=1)</p>
<p>   (embed_positions): LearnedPositionalEmbedding(514, 768, padding_idx=1)</p>
<p>   (layers): ModuleList(</p>
<p>​    (0): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (1): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (2): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (3): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (4): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (5): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (6): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (7): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (8): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (9): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (10): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>​    (11): TransformerSentenceEncoderLayer(</p>
<p>​     (dropout_module): FairseqDropout()</p>
<p>​     (activation_dropout_module): FairseqDropout()</p>
<p>​     (self_attn): MultiheadAttention(</p>
<p>​      (dropout_module): FairseqDropout()</p>
<p>​      (k_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (v_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (q_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​      (out_proj): Linear(in_features=768, out_features=768, bias=True)</p>
<p>​     )</p>
<p>​     (self_attn_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​     (fc1): Linear(in_features=768, out_features=3072, bias=True)</p>
<p>​     (fc2): Linear(in_features=3072, out_features=768, bias=True)</p>
<p>​     (final_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>​    )</p>
<p>   )</p>
<p>   (emb_layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>  )</p>
<p>  (lm_head): RobertaLMHead(</p>
<p>   (dense): Linear(in_features=768, out_features=768, bias=True)</p>
<p>   (layer_norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)</p>
<p>  )</p>
<p> )</p>
<p> (classification_heads): ModuleDict()</p>
<p>)</p>
<p>2020-12-28 15:40:51 | INFO | fairseq_cli.train | task: MaskedLMTask</p>
<p>2020-12-28 15:40:51 | INFO | fairseq_cli.train | model: RobertaModel</p>
<p>2020-12-28 15:40:51 | INFO | fairseq_cli.train | criterion: MaskedLmLoss</p>
<p>2020-12-28 15:40:51 | INFO | fairseq_cli.train | num. model params: 124696665 (num. trained: 124696665)</p>
<p>2020-12-28 15:40:56 | INFO | fairseq.trainer | detected shared parameter: encoder.sentence_encoder.embed_tokens.weight &lt;- encoder.lm_head.weight</p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>CUDA enviroments for all 8 workers</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  0: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  1: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  2: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  3: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  4: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  5: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  6: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | rank  7: capabilities = 7.5 ; total memory = 23.653 GB ; name = TITAN RTX                </p>
<p>2020-12-28 15:40:57 | INFO | fairseq.utils | <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>CUDA enviroments for all 8 workers</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>2020-12-28 15:40:57 | INFO | fairseq_cli.train | training on 8 devices (GPUs/TPUs)</p>
<p>2020-12-28 15:40:57 | INFO | fairseq_cli.train | max tokens per GPU = None and batch size per GPU = 16</p>
<p>2020-12-28 15:40:57 | INFO | fairseq.trainer | Preparing to load checkpoint checkpoints/checkpoint_last.pt</p>
<p>2020-12-28 15:40:57 | INFO | fairseq.trainer | No existing checkpoint found checkpoints/checkpoint_last.pt</p>
<p>2020-12-28 15:40:57 | INFO | fairseq.trainer | loading train data for epoch 1</p>
<p>2020-12-28 15:40:57 | INFO | fairseq.data.data_utils | loaded 1801350 examples from: data-bin/wikitext-103/train</p>
<p>2020-12-28 15:40:57 | INFO | fairseq.tasks.masked_lm | loaded 280678 blocks from: data-bin/wikitext-103/train</p>
<p>$fairseq$模型解析</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/141210591">https://zhuanlan.zhihu.com/p/141210591</a></p>
<p>![1](/学习fairseq之Roberta/截屏2020-12-28 下午4.38.11.png)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/28/%E5%AD%A6%E4%B9%A0fairseq%E4%B9%8BRoberta/" data-id="ckjchmpho0007e0fyek1c9qpl" data-title="学习fairseq之Roberta" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-AttributeError-module-enum-has-no-attribute-IntFlag" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/25/AttributeError-module-enum-has-no-attribute-IntFlag/" class="article-date">
  <time class="dt-published" datetime="2020-12-25T04:00:57.000Z" itemprop="datePublished">2020-12-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/25/AttributeError-module-enum-has-no-attribute-IntFlag/">AttributeError: module &#39;enum&#39; has no attribute &#39;IntFlag&#39;</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>enum的路径问题。</p>
<p>卸载掉enum34即可。</p>
<p><code>pip uninstall enum34</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/25/AttributeError-module-enum-has-no-attribute-IntFlag/" data-id="ckjchmphb0000e0fy7npfdeis" data-title="AttributeError: module &#39;enum&#39; has no attribute &#39;IntFlag&#39;" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-查看库的版本" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/25/%E6%9F%A5%E7%9C%8B%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC/" class="article-date">
  <time class="dt-published" datetime="2020-12-25T03:36:52.000Z" itemprop="datePublished">2020-12-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/25/%E6%9F%A5%E7%9C%8B%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC/">查看库的版本</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt list --installed</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip list</span><br></pre></td></tr></table></figure>




<ul>
<li><p>查看Pytorch版本的方法：</p>
<p>进入python交互环境，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">print(torch.__version__)</span><br></pre></td></tr></table></figure></li>
<li><p>查看conda版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda --version</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>查看cuda版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.version.cuda</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>查看numpy版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip show numpy</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/25/%E6%9F%A5%E7%9C%8B%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC/" data-id="ckjchmphk0005e0fybujl5238" data-title="查看库的版本" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Docker installation in Mac" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/24/Docker%20installation%20in%20Mac/" class="article-date">
  <time class="dt-published" datetime="2020-12-24T05:15:54.000Z" itemprop="datePublished">2020-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/24/Docker%20installation%20in%20Mac/">Docker installation</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><p>download docker desktop from  <a target="_blank" rel="noopener" href="https://hub.docker.com/editions/community/docker-ce-desktop-mac/">https://hub.docker.com/editions/community/docker-ce-desktop-mac/</a></p>
</li>
<li><p>double click <code>Docker.dmg</code> file</p>
</li>
<li><p>drag the Docker icon to the application folder</p>
</li>
<li><p>dougle click <code>Docker.app</code> to start Docker</p>
</li>
<li><p>check if the Docker is installed successfully in command line</p>
<p><code>docker version</code></p>
<p><code>docker-compose --version</code></p>
<p><code>docker-machine --version</code></p>
</li>
<li><p>How to solve <em>command not found docker-machine error</em>?</p>
<ul>
<li>install Docker Machine</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base=https:<span class="comment">//github.com/docker/machine/releases/download/v0.16.0 &amp;&amp;</span></span><br><span class="line">  curl -L $base/docker-machine-$(uname -s)-$(uname -m) &gt;<span class="regexp">/usr/</span>local/bin/docker-machine &amp;&amp;</span><br><span class="line">  chmod +x /usr/local/bin/docker-machine</span><br></pre></td></tr></table></figure></li>
<li><p>添加镜像加速器</p>
<p>注册<a target="_blank" rel="noopener" href="https://homenew.console.aliyun.com/home/scene/ProductAndService">阿里云</a>，获取镜像加速器地址。</p>
<p>点击Docker图标，Preferences-&gt;Docker Engine，在右侧窗口修改json信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;experimental&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;features&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;buildkit&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://14b3r05r.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击Apply and Restart</p>
<p>输入<code>docker info</code>就可以查看是否添加成功。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/24/Docker%20installation%20in%20Mac/" data-id="ckjchmphg0001e0fy3xa6cxyj" data-title="Docker installation" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hexo-blog-in-Mac" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/24/hexo-blog-in-Mac/" class="article-date">
  <time class="dt-published" datetime="2020-12-24T02:07:08.000Z" itemprop="datePublished">2020-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/24/hexo-blog-in-Mac/">hexo-blog-in-Mac</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>官网 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a> </p>
<p>安装 git</p>
<p>安装node.js, <code>brew install node</code></p>
<p>安装hexo， <code>npm install -g hexo-cli</code></p>
<p>创建个人博客目录 <code>mkdir MyBlog</code></p>
<p><code>hexo init</code></p>
<p><code>hexo s</code>, Hexo is running at <a target="_blank" rel="noopener" href="http://localhost:4000/">http://localhost:4000</a> . Press Ctrl+C to stop. 打开网页，</p>
<p>博客关联到github仓库：配置_config.yml文件。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs: https://hexo.io/docs/one-command-deployment</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https:<span class="comment">//github.com/UserName/UserName.github.io</span></span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>
<p>产生静态网页： <code>hexo g</code></p>
<p>部署到GitHub page上：<code> hexo d</code></p>
<p>#出现错误1：</p>
<p>INFO Validating config</p>
<p>ERROR Deployer not found: git</p>
<p>解决办法： <code>npm install --save hexo-deployer-git</code></p>
<p>#出现错误2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">*** Please tell me who you are.</span><br><span class="line"></span><br><span class="line">Run</span><br><span class="line"></span><br><span class="line"> git config --<span class="built_in">global</span> user.email <span class="string">&quot;you@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"> git config --<span class="built_in">global</span> user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line"></span><br><span class="line">to set your account<span class="string">&#x27;s default identity.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Omit --global to set the identity only in this repository.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fatal: unable to auto-detect email address (got &#x27;</span>cbl@bogon.(none)<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">error: src refspec HEAD does not match any</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">error: failed to push some refs to &#x27;</span>https:<span class="comment">//github.com/CBLkfit/CBLkfit.github.io&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解决办法：设置好git config</p>
<ul>
<li><p>图片添加以及上载问题：</p>
<p>第一步：安装插件 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure>
<p>第二步：打开hexo配置文件_config.yml</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>第三步：打开 node_modules/hexo-asset-image/index.js文件，更换为以下内容：</p>
</li>
</ul>
<p>  第四步：验证是否能正确插入图片。hexo n ‘add_photo’，在source/_posts下生成add_photo.md文件和add_photo文件夹。把要插入的图片复制到add_photo文件夹下，在md文件里，用下面的代码就可以插入图片啦。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/24/hexo-blog-in-Mac/" data-id="ckjchmphi0003e0fy9uv51vmm" data-title="hexo-blog-in-Mac" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Transformers预训练模型的使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/24/Transformers%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2020-12-24T01:50:06.000Z" itemprop="datePublished">2020-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/24/Transformers%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8/">Transformers预训练模型的使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/">创建虚拟环境</a></p>
</li>
<li><p>在文件目录下，运行 </p>
</li>
</ul>
<p><code>python3 -m venv env</code></p>
<p><code>source env/bin/activate</code></p>
<ul>
<li><p>如果要离开虚拟环境，运行 <code>deactivate</code></p>
</li>
<li><p>installing from source</p>
</li>
</ul>
<p><code>git clone https://github.com/huggingface/transformers.git</code></p>
<p><code>cd transformers</code></p>
<p><code>pip install -e .</code></p>
<p>测试</p>
<p><code>python -c &quot;from transformers import pipeline; print(pipeline(&#39;sentiment-analysis&#39;)(&#39;I hate you’))”</code></p>
<p>会输出<code> [&#123;&#39;label&#39;: &#39;NEGATIVE&#39;, &#39;score&#39;: 0.9991129040718079&#125;]</code></p>
<p><strong>报错</strong></p>
<ul>
<li>若提示没有Pytorch或者Tensorflow，<code>pip3 install torch torchvision</code></li>
<li>ValueError: Connection error, and we cannot find the requested files in the cached path. Please try again or make sure your Internet connection is on. 网的问题</li>
<li>Exception has occurred: OSError Unable to load weights from pytorch checkpoint file. If you tried to load a PyTorch model from a TF 2.0 checkpoint, please set from_tf=True. 解决办法：清除  ~/.cache/torch/transformers下的所有文件后重试。</li>
</ul>
<p><strong>针对网络问题，手动下载，本地加载预训练权重</strong></p>
<p>网站<a target="_blank" rel="noopener" href="https://huggingface.co/models%E5%8C%85%E5%90%AB%E4%BA%86transformers%E6%94%AF%E6%8C%81%E7%9A%84%E6%89%80%E6%9C%89%E6%A8%A1%E5%9E%8B%EF%BC%8C%E9%80%89%E4%B8%AD%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%E3%80%82%E4%BB%A5bert-base-uncased%E4%B8%BA%E4%BE%8B%E3%80%82%E7%82%B9%E5%BC%80files">https://huggingface.co/models包含了transformers支持的所有模型，选中需要下载的模型。以bert-base-uncased为例。点开files</a> and versions，可以看到文件列表，找到列表中的config.json，pytorch_model.bin和vocab文件，点击下载图标，下载到指定文件夹bert-base-uncased中。config.json是模型的配置文件，pytorch_model.bin是存储的预训练模型，vocab是字典。</p>
<p><img src="/Users/cbl/MyBlog/source/_posts/Transformers%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8/%E6%9C%AC%E5%9C%B0%E5%8A%A0%E8%BD%BD.png" alt="本地加载"></p>


<p><strong>如何在虚拟环境下运行jupyter notebook</strong></p>
<p>参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0432155d1bef">https://www.jianshu.com/p/0432155d1bef</a></p>
<p>为虚拟环境安装ikernel包</p>
<p><code>pip3 install ipykernel</code></p>
<p>激活环境</p>
<p><code>python -m ipykernel install —name env</code></p>
<p><strong><em>\</em>{****% asset_img test.jpg This is an test image %**}*\</strong>***</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/24/Transformers%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="ckjchmphh0002e0fy4qucc02p" data-title="Transformers预训练模型的使用" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/31/logistic%20regression/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/12/30/%E7%94%A8docker%E9%83%A8%E7%BD%B2python%E7%8E%AF%E5%A2%83/">用docker部署python环境</a>
          </li>
        
          <li>
            <a href="/2020/12/28/%E5%AD%A6%E4%B9%A0fairseq%E4%B9%8BRoberta/">学习fairseq之Roberta</a>
          </li>
        
          <li>
            <a href="/2020/12/25/AttributeError-module-enum-has-no-attribute-IntFlag/">AttributeError: module &#39;enum&#39; has no attribute &#39;IntFlag&#39;</a>
          </li>
        
          <li>
            <a href="/2020/12/25/%E6%9F%A5%E7%9C%8B%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC/">查看库的版本</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2020 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>